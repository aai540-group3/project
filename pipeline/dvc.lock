schema: '2.0'
stages:
  setup:
    cmd:
    - python3 -m virtualenv .venv
    - . .venv/bin/activate
    - pip install uv
    - uv pip install -r requirements.txt
    - pip freeze > requirements-frozen.txt
    - .venv/bin/python src/utils.py patch_nvidia_gpu
    deps:
    - path: requirements.txt
      hash: md5
      md5: 1759e119dacdc25fb158aeef9df29b65
      size: 409
    - path: src/utils.py
      hash: md5
      md5: fa0c7868e939589e8646c7275141ddcc
      size: 1248
      isexec: true
    outs:
    - path: requirements-frozen.txt
      hash: md5
      md5: 495bf7a4ad0fc161c91a663531b153ca
      size: 8410
  infrastruct:
    cmd: .venv/bin/python src/infrastruct.py
    deps:
    - path: requirements-frozen.txt
      hash: md5
      md5: 495bf7a4ad0fc161c91a663531b153ca
      size: 8410
    - path: src/infrastruct.py
      hash: md5
      md5: 007ddab3349fca1540e75fc7add9923b
      size: 17745
      isexec: true
  preprocess:
    cmd: .venv/bin/python src/preprocess.py
    deps:
    - path: data/raw/data.csv
      hash: md5
      md5: 33411fa1536aaaadb24c0c1f2a8598b9
      size: 16246860
    - path: requirements-frozen.txt
      hash: md5
      md5: 495bf7a4ad0fc161c91a663531b153ca
      size: 8410
    - path: src/preprocess.py
      hash: md5
      md5: 2bc43cea6c2be849c83ec2f7afeb4639
      size: 11286
    outs:
    - path: data/interim/data_cleaned.parquet
      hash: md5
      md5: 134acddfa1711ae8b4da5ae4a2563557
      size: 1699934
  featurize:
    cmd: PROTOCOL_BUFFERS_PYTHON_IMPLEMENTATION=python .venv/bin/python src/featurize.py
    deps:
    - path: data/interim/data_cleaned.parquet
      hash: md5
      md5: 134acddfa1711ae8b4da5ae4a2563557
      size: 1699934
    - path: feature_store.yaml
      hash: md5
      md5: fd33cd8885f2ace4a3063c10ad6b5ba5
      size: 166
    - path: requirements-frozen.txt
      hash: md5
      md5: 495bf7a4ad0fc161c91a663531b153ca
      size: 8410
    - path: src/featurize.py
      hash: md5
      md5: 48767b2e09faa7f78e0f8a23bcb6ab5c
      size: 15263
    outs:
    - path: data/interim/data_featured.parquet
      hash: md5
      md5: de90f78babb366d8b5e28180feb10cfc
      size: 4971379
  explore:
    cmd: .venv/bin/python src/explore.py
    deps:
    - path: data/interim/data_cleaned.parquet
      hash: md5
      md5: 134acddfa1711ae8b4da5ae4a2563557
      size: 1699934
    - path: data/raw/data.csv
      hash: md5
      md5: 33411fa1536aaaadb24c0c1f2a8598b9
      size: 16246860
    - path: requirements-frozen.txt
      hash: md5
      md5: 495bf7a4ad0fc161c91a663531b153ca
      size: 8410
    - path: src/explore.py
      hash: md5
      md5: 5db5255030273c94d257a5799ff2e917
      size: 12372
    outs:
    - path: reports/cleanlab/cleanlab_confidence_distribution.png
      hash: md5
      md5: 84f58bf10b3c76799492c2b88204fc21
      size: 160370
    - path: reports/cleanlab/cleanlab_confusion_matrix.png
      hash: md5
      md5: 8e78d28c59eeaf6e276adb79de744555
      size: 100044
    - path: reports/cleanlab/detailed_analysis.txt
      hash: md5
      md5: 99ae7692bdbe2cf763ec65ba890091db
      size: 675
    - path: reports/cleanlab/feature_importance.csv
      hash: md5
      md5: faabb7a3d2885460d210604060e35cb3
      size: 52534
    - path: reports/cleanlab/problematic_cases.csv
      hash: md5
      md5: 5e7a80d65145ac4f0148a69290516a7c
      size: 220116
    - path: reports/plots/age_vs_readmission.png
      hash: md5
      md5: 8a40bd9fb68422f1fe4fe48da768cd01
      size: 184203
    - path: reports/plots/correlation_matrix.png
      hash: md5
      md5: b8d3693618e7ab03f4ca80e19009a35e
      size: 676101
    - path: reports/plots/readmitted_distribution.png
      hash: md5
      md5: 6b8c2cd4f4c2c346e54bccc300fbca54
      size: 93876
    - path: reports/plots/service_utilization_vs_readmission.png
      hash: md5
      md5: bd6ef7a2dbeb2b59ee003de7ae96c8ac
      size: 101081
    - path: reports/plots/time_in_hospital_vs_readmission.png
      hash: md5
      md5: 27667f6e3a4c238b25c3805b2753aa21
      size: 93844
  ingest_parquet:
    cmd: .venv/bin/python src/ingest.py
    deps:
    - path: requirements-frozen.txt
      hash: md5
      md5: 495bf7a4ad0fc161c91a663531b153ca
      size: 8410
    - path: src/ingest.py
      hash: md5
      md5: 4834dee50d39bc8738573b1d25632ce3
      size: 2691
    outs:
    - path: data/raw/data.parquet
      hash: md5
      md5: 70194fd7340a638e7a98b5d5a2a99ed6
      size: 1419892
  ingest_csv:
    cmd: .venv/bin/python src/ingest.py
    deps:
    - path: requirements-frozen.txt
      hash: md5
      md5: 495bf7a4ad0fc161c91a663531b153ca
      size: 8410
    - path: src/ingest.py
      hash: md5
      md5: 4834dee50d39bc8738573b1d25632ce3
      size: 2691
    outs:
    - path: data/raw/data.csv
      hash: md5
      md5: 33411fa1536aaaadb24c0c1f2a8598b9
      size: 16246860
    - path: data/raw/metadata.json
      hash: md5
      md5: eb8bd36c2cc7a6284a657c63561e0225
      size: 5125
    - path: data/raw/variables.json
      hash: md5
      md5: c03764d3560b025c3f1291d585517221
      size: 19001

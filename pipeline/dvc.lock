schema: '2.0'
stages:
  setup:
    cmd:
    - uv venv .venv-setup --python 3.10
    - . .venv-setup/bin/activate && uv pip install -r requirements.txt
    - . .venv-setup/bin/activate && uv pip freeze > requirements-frozen.txt
    deps:
    - path: requirements.txt
      hash: md5
      md5: 2fa59e3161e5d835f2147f8fa931df01
      size: 33
    outs:
    - path: requirements-frozen.txt
      hash: md5
      md5: 81e44ab0c6698a83b40884bbfbe22b03
      size: 2702
  infrastruct:
    cmd:
    - uv venv .venv-infrastruct --python 3.10
    - . .venv-infrastruct/bin/activate && uv pip install -r requirements-infrastruct.txt
    - . .venv-infrastruct/bin/activate && uv pip freeze > requirements-infrastruct-frozen.txt
    - . .venv-infrastruct/bin/activate && python src/infrastruct.py
    deps:
    - path: requirements-infrastruct.txt
      hash: md5
      md5: 60b865dddcfe1ba5e216406717be77a4
      size: 19
    - path: src/infrastruct.py
      hash: md5
      md5: 007ddab3349fca1540e75fc7add9923b
      size: 17745
      isexec: true
    outs:
    - path: requirements-infrastruct-frozen.txt
      hash: md5
      md5: 7a6a7eeb309a45fd9b797ba5f283ef4e
      size: 145
  preprocess:
    cmd:
    - uv venv .venv-preprocess --python 3.10
    - . .venv-preprocess/bin/activate && uv pip install -r requirements-preprocess.txt
    - . .venv-preprocess/bin/activate && uv pip freeze > requirements-preprocess-frozen.txt
    - . .venv-preprocess/bin/activate && python src/preprocess.py
    deps:
    - path: data/raw/data.csv
      hash: md5
      md5: 33411fa1536aaaadb24c0c1f2a8598b9
      size: 16246860
    - path: requirements-preprocess.txt
      hash: md5
      md5: 2e6b6474c7d7de529a7e5dc2b1761a27
      size: 50
    - path: src/preprocess.py
      hash: md5
      md5: 6e228dfee240417d5c1cde30098bf9cc
      size: 11521
    outs:
    - path: data/interim/data_cleaned.parquet
      hash: md5
      md5: 8a993448e091a2345c5a95bd3f487f3e
      size: 1694762
    - path: data/interim/feature_names.joblib
      hash: md5
      md5: 7223e8718fe6f7173ebc871bf4d5cc6d
      size: 637
    - path: requirements-preprocess-frozen.txt
      hash: md5
      md5: c2305f39a4e93dcf492f05d387313fc1
      size: 3182
  featurize:
    cmd:
    - uv venv .venv-featurize --python 3.11
    - . .venv-featurize/bin/activate && uv pip install -r requirements-featurize.txt
    - . .venv-featurize/bin/activate && uv pip freeze > requirements-featurize-frozen.txt
    - . .venv-featurize/bin/activate && PROTOCOL_BUFFERS_PYTHON_IMPLEMENTATION=python
      python src/featurize.py
    deps:
    - path: data/interim/data_cleaned.parquet
      hash: md5
      md5: 8a993448e091a2345c5a95bd3f487f3e
      size: 1694762
    - path: feature_store.yaml
      hash: md5
      md5: f690725d429449b466c260205d8da47a
      size: 202
    - path: requirements-featurize.txt
      hash: md5
      md5: 4f9f52b9fe2d29796d3f210c33ed92d0
      size: 102
    - path: src/featurize.py
      hash: md5
      md5: 4ccca48843ebfc7015b379ad1b4c2b17
      size: 15282
    outs:
    - path: data/interim/data_featured.parquet
      hash: md5
      md5: 88b9b757e826fe71dd0767283db452a0
      size: 4960350
    - path: requirements-featurize-frozen.txt
      hash: md5
      md5: f8e5faf3be1ed9b9d9f23762897407d2
      size: 3792
  explore:
    cmd:
    - uv venv .venv-explore --python 3.10
    - . .venv-explore/bin/activate && uv pip install -r requirements-explore.txt
    - . .venv-explore/bin/activate && uv pip freeze > requirements-explore-frozen.txt
    - . .venv-explore/bin/activate && python src/explore.py
    deps:
    - path: data/interim/data_cleaned.parquet
      hash: md5
      md5: 8a993448e091a2345c5a95bd3f487f3e
      size: 1694762
    - path: data/raw/data.csv
      hash: md5
      md5: 33411fa1536aaaadb24c0c1f2a8598b9
      size: 16246860
    - path: requirements-explore.txt
      hash: md5
      md5: 4b77418d951d952f692eb79b45b0fe7e
      size: 78
    - path: src/explore.py
      hash: md5
      md5: 5db5255030273c94d257a5799ff2e917
      size: 12372
    outs:
    - path: requirements-explore-frozen.txt
      hash: md5
      md5: 39573a2880e1d810ca446d0a99246799
      size: 3332
  ingest_parquet:
    cmd: .venv/bin/python src/ingest.py
    deps:
    - path: requirements-frozen.txt
      hash: md5
      md5: 495bf7a4ad0fc161c91a663531b153ca
      size: 8410
    - path: src/ingest.py
      hash: md5
      md5: 4834dee50d39bc8738573b1d25632ce3
      size: 2691
    outs:
    - path: data/raw/data.parquet
      hash: md5
      md5: 70194fd7340a638e7a98b5d5a2a99ed6
      size: 1419892
  ingest_csv:
    cmd: .venv/bin/python src/ingest.py
    deps:
    - path: requirements-frozen.txt
      hash: md5
      md5: 495bf7a4ad0fc161c91a663531b153ca
      size: 8410
    - path: src/ingest.py
      hash: md5
      md5: 4834dee50d39bc8738573b1d25632ce3
      size: 2691
    outs:
    - path: data/raw/data.csv
      hash: md5
      md5: 33411fa1536aaaadb24c0c1f2a8598b9
      size: 16246860
    - path: data/raw/metadata.json
      hash: md5
      md5: eb8bd36c2cc7a6284a657c63561e0225
      size: 5125
    - path: data/raw/variables.json
      hash: md5
      md5: c03764d3560b025c3f1291d585517221
      size: 19001
  ingest:
    cmd:
    - uv venv .venv-ingest --python 3.10
    - . .venv-ingest/bin/activate && uv pip install -r requirements-ingest.txt
    - . .venv-ingest/bin/activate && uv pip freeze > requirements-ingest-frozen.txt
    - . .venv-ingest/bin/activate && python src/ingest.py
    deps:
    - path: requirements-ingest.txt
      hash: md5
      md5: b6ace7c12bf4b84c615e2b4e80cd6b96
      size: 81
    - path: src/ingest.py
      hash: md5
      md5: 4834dee50d39bc8738573b1d25632ce3
      size: 2691
    outs:
    - path: data/raw/data.csv
      hash: md5
      md5: 33411fa1536aaaadb24c0c1f2a8598b9
      size: 16246860
    - path: data/raw/data.parquet
      hash: md5
      md5: 80180ca21b2e0a18573675cdb3f741de
      size: 1415409
    - path: data/raw/metadata.json
      hash: md5
      md5: eb8bd36c2cc7a6284a657c63561e0225
      size: 5125
    - path: data/raw/variables.json
      hash: md5
      md5: c03764d3560b025c3f1291d585517221
      size: 19001
    - path: requirements-ingest-frozen.txt
      hash: md5
      md5: e0c178753978f90b57418df096b18cca
      size: 3220
  train_logistic_regression:
    cmd: .venv/bin/python models/logistic_regression/model.py
    deps:
    - path: data/interim/data_featured.parquet
      hash: md5
      md5: bcfcb4257ebc5523176cabc88c2278c3
      size: 4971381
    - path: models/logistic_regression/model.py
      hash: md5
      md5: df7d5793fa43b6d64227fb82088ddd52
      size: 18556
    - path: requirements-frozen.txt
      hash: md5
      md5: 495bf7a4ad0fc161c91a663531b153ca
      size: 8410
  train_autogluon:
    cmd: PROTOCOL_BUFFERS_PYTHON_IMPLEMENTATION=python .venv/bin/python models/autogluon/model.py
    deps:
    - path: data/interim/data_featured.parquet
      hash: md5
      md5: bcfcb4257ebc5523176cabc88c2278c3
      size: 4971381
    - path: models/autogluon/model.py
      hash: md5
      md5: 24b83fd37beaf1a56bb794a50036dcde
      size: 18491
    - path: requirements-frozen.txt
      hash: md5
      md5: 495bf7a4ad0fc161c91a663531b153ca
      size: 8410
  train_neural_network:
    cmd: .venv/bin/python models/neural_network/model.py
    deps:
    - path: data/interim/data_featured.parquet
      hash: md5
      md5: bcfcb4257ebc5523176cabc88c2278c3
      size: 4971381
    - path: models/neural_network/model.py
      hash: md5
      md5: e0dab3b3599ff9845ddc32e38cfed965
      size: 20372
    - path: requirements-frozen.txt
      hash: md5
      md5: 495bf7a4ad0fc161c91a663531b153ca
      size: 8410

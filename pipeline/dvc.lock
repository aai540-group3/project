schema: '2.0'
stages:
  ingest:
    cmd: .venv/bin/python src/ingest.py
    deps:
    - path: requirements-frozen.txt
      hash: md5
      md5: 495bf7a4ad0fc161c91a663531b153ca
      size: 8410
    - path: src/ingest.py
      hash: md5
      md5: 4834dee50d39bc8738573b1d25632ce3
      size: 2691
    outs:
    - path: data/raw/data.csv
      hash: md5
      md5: 33411fa1536aaaadb24c0c1f2a8598b9
      size: 16246860
    - path: data/raw/metadata.json
      hash: md5
      md5: eb8bd36c2cc7a6284a657c63561e0225
      size: 5125
    - path: data/raw/variables.json
      hash: md5
      md5: c03764d3560b025c3f1291d585517221
      size: 19001
  feature_engineering:
    cmd: CONFIG_PATH=$(pwd)/conf CONFIG_NAME=config .venv/bin/python data/build_features.py
    deps:
    - path: data/build_features.py
      hash: md5
      md5: 290c5abecbca5a5158d7fb0edfd35e51
      size: 4200
    - path: data/interim/data_cleaned.csv
      hash: md5
      md5: f1d6c377d981e8ba3a9f92775ecb85d6
      size: 70117495
    params:
      params.yaml:
        data.featured_file: data/processed/data_featured.csv
        data.interim_file: data/interim/data_cleaned.csv
        feature_engineering:
          add_polynomial_features: true
          poly_degree: 2
  split:
    cmd: python3 data/splitting.py
    deps:
    - path: data/interim/data.csv
      hash: md5
      md5: f1d6c377d981e8ba3a9f92775ecb85d6
      size: 70117495
    - path: data/splitting.py
      hash: md5
      md5: 647695c098c3af4747a54cf46a4c679c
      size: 3379
    params:
      params.yaml:
        dataset.path.interim: data/interim
        dataset.path.processed: data/processed
        training.split:
          test_size: 0.2
          random_state: 42
    outs:
    - path: data/processed/test.csv
      hash: md5
      md5: cfd9fd8441b890900bee61eaaf60a7d8
      size: 14026237
    - path: data/processed/train.csv
      hash: md5
      md5: 63f4b9c70d6b7d30d4fa2aa564d9205d
      size: 56094172
  preprocess@logistic_regression:
    cmd: python3 models/logistic_regression/preprocessing.py model=logistic_regression
    deps:
    - path: data/processed/train.csv
      hash: md5
      md5: 63f4b9c70d6b7d30d4fa2aa564d9205d
      size: 56094172
    - path: models/logistic_regression/preprocessing.py
      hash: md5
      md5: f66780482f6e658537716319ce43ed85
      size: 4403
    params:
      params.yaml:
        dataset.path.processed: data/processed
        model.logistic_regression:
          name: logistic_regression
          params:
            penalty: l2
            C: 1.0
            solver: lbfgs
            max_iter: 1000
            random_state: 42
    outs:
    - path: data/processed/logistic_regression/train_preprocessed.csv
      hash: md5
      md5: 83cc48c279024b3327dc1ccebefeb4ba
      size: 47491440
  preprocess@autogluon:
    cmd: python3 models/autogluon/preprocessing.py model=autogluon
    deps:
    - path: data/processed/train.csv
      hash: md5
      md5: 63f4b9c70d6b7d30d4fa2aa564d9205d
      size: 56094172
    - path: models/autogluon/preprocessing.py
      hash: md5
      md5: 123a0e5e57ceeec409501150386269ad
      size: 4986
    params:
      params.yaml:
        dataset.path.processed: data/processed
        model.autogluon:
          name: autogluon
          params:
            presets: best_quality
            eval_metric: accuracy
    outs:
    - path: data/processed/autogluon/train_preprocessed.csv
      hash: md5
      md5: ac24323e785816591d8540a9701ca25c
      size: 47491440
  train@logistic_regression:
    cmd: python3 models/logistic_regression/train.py model=logistic_regression
    deps:
    - path: data/processed/logistic_regression/train_preprocessed.csv
      hash: md5
      md5: 83cc48c279024b3327dc1ccebefeb4ba
      size: 47491440
    - path: models/logistic_regression/train.py
      hash: md5
      md5: 4686c4469e113e8c1e48c758f98bdb1b
      size: 5904
    params:
      params.yaml:
        dataset.path.processed: data/processed
        model.logistic_regression:
          name: logistic_regression
          params:
            penalty: l2
            C: 1.0
            solver: lbfgs
            max_iter: 1000
            random_state: 42
    outs:
    - path: models/logistic_regression/model.pkl
      hash: md5
      md5: 7ccc3e08cb52d965e66d3a9bc3dcfb54
      size: 6159
  train@autogluon:
    cmd: python3 models/autogluon/train.py model=autogluon
    deps:
    - path: data/processed/autogluon/train_preprocessed.csv
      hash: md5
      md5: ac24323e785816591d8540a9701ca25c
      size: 47491440
    - path: models/autogluon/train.py
      hash: md5
      md5: b68cccc2eaa5aec9b0cd9240c5013b06
      size: 6531
    params:
      params.yaml:
        dataset.path.processed: data/processed
        model.autogluon:
          name: autogluon
          params:
            presets: best_quality
            eval_metric: accuracy
    outs:
    - path: models/autogluon/model.pkl
      hash: md5
      md5: 070ffe55680f3fcd5ad30368ddf0a38b
      size: 79793
  evaluate@logistic_regression:
    cmd: python3 models/logistic_regression/evaluate.py model=logistic_regression
    deps:
    - path: data/processed/test.csv
      hash: md5
      md5: cfd9fd8441b890900bee61eaaf60a7d8
      size: 14026237
    - path: models/logistic_regression/evaluate.py
      hash: md5
      md5: a142859cc83a1afcca92515912496a6f
      size: 8107
    - path: models/logistic_regression/model.pkl
      hash: md5
      md5: 7ccc3e08cb52d965e66d3a9bc3dcfb54
      size: 6159
    params:
      params.yaml:
        dataset.path.processed: data/processed
        model.logistic_regression:
          name: logistic_regression
          params:
            penalty: l2
            C: 1.0
            solver: lbfgs
            max_iter: 1000
            random_state: 42
    outs:
    - path: reports/metrics/logistic_regression_metrics.json
      hash: md5
      md5: e71750b133aa7399768c7ac9e7863481
      size: 180
  setup:
    cmd:
    - python3 -m virtualenv .venv
    - . .venv/bin/activate
    - pip install uv
    - uv pip install -r requirements.txt
    - pip freeze > requirements-frozen.txt
    - .venv/bin/python src/utils.py patch_nvidia_gpu
    deps:
    - path: requirements.txt
      hash: md5
      md5: 19831d93db18b11d973a80076186132a
      size: 400
    - path: src/utils.py
      hash: md5
      md5: fa0c7868e939589e8646c7275141ddcc
      size: 1248
      isexec: true
    outs:
    - path: requirements-frozen.txt
      hash: md5
      md5: 495bf7a4ad0fc161c91a663531b153ca
      size: 8410
  create_virtualenv:
    cmd: python3 -m virtualenv .venv
    outs:
    - path: .venv/
      hash: md5
      md5: 8a140686a32a8ee42484bc10b3fcd755.dir
      size: 10140227
      nfiles: 1020
  activate_virtualenv:
    cmd: source .venv/bin/activate
    deps:
    - path: .venv/
      hash: md5
      md5: 8a140686a32a8ee42484bc10b3fcd755.dir
      size: 10140227
      nfiles: 1020
  install_requirements:
    cmd: pip install -r requirements.txt
    deps:
    - path: .venv/
      hash: md5
      md5: 8a140686a32a8ee42484bc10b3fcd755.dir
      size: 10140227
      nfiles: 1020
    - path: requirements.txt
      hash: md5
      md5: 384284a65dae2f34c3a0d876b647301a
      size: 151
  setup_virtualenv:
    cmd:
    - python3 -m virtualenv .venv
    - . .venv/bin/activate
    - pip install uv
    - uv pip install -r requirements.txt
    deps:
    - path: requirements.txt
      hash: md5
      md5: 17f8ceaf396ab1ada066534e085ead96
      size: 312
  install_dependencies:
    cmd:
    - . .venv/bin/activate
    - pip install uv
    - uv pip install -r requirements.txt
    deps:
    - path: requirements.txt
      hash: md5
      md5: 17f8ceaf396ab1ada066534e085ead96
      size: 312
  fix_gpu_issue:
    cmd:
    - .venv/bin/python scripts/fix-nvidia-gpu.py
    deps:
    - path: scripts/fix-nvidia-gpu.py
      hash: md5
      md5: 1d344b48a40bb83d6d50b10feeac0d8f
      size: 3948
      isexec: true
  data_ingestion:
    cmd: CONFIG_PATH=$(pwd)/conf CONFIG_NAME=config .venv/bin/python data/ingestion.py
    deps:
    - path: data/ingestion.py
      hash: md5
      md5: 1e143da55bd4ff5155d10391be1f830e
      size: 1851
    params:
      params.yaml:
        data.raw_file: data/raw/data.csv
        dataset.name: aai540-group3/diabetes-readmission
    outs:
    - path: data/raw/data.csv
      hash: md5
      md5: dbfe12c203805ccf7fdb683042c46ab3
      size: 49159045
  data_cleaning:
    cmd: CONFIG_PATH=$(pwd)/conf CONFIG_NAME=config .venv/bin/python data/cleaning.py
    deps:
    - path: data/cleaning.py
      hash: md5
      md5: 1320da365a9cf8c3ba619f8a0e0692f9
      size: 4211
    - path: data/raw/data.csv
      hash: md5
      md5: dbfe12c203805ccf7fdb683042c46ab3
      size: 49159045
    params:
      params.yaml:
        data.interim_file: data/interim/data_cleaned.csv
        data.raw_file: data/raw/data.csv
    outs:
    - path: data/interim/data_cleaned.csv
      hash: md5
      md5: f1d6c377d981e8ba3a9f92775ecb85d6
      size: 70117495
  data_splitting:
    cmd: CONFIG_PATH=$(pwd)/conf CONFIG_NAME=config .venv/bin/python data/splitting.py
    deps:
    - path: data/processed/data_featured.csv
      hash: md5
      md5: 0c59f6ccd93cd6b47eabd842378f78a8
      size: 72854176
    - path: data/splitting.py
      hash: md5
      md5: b8ac9a6e9f8cb60be2ac9cb5f1b42af7
      size: 2986
    params:
      params.yaml:
        data.featured_file: data/processed/data_featured.csv
        data.test_file: data/processed/test.csv
        data.train_file: data/processed/train.csv
        training.split:
          test_size: 0.2
          random_state: 42
  model_preprocessing@logistic_regression:
    cmd: CONFIG_PATH=$(pwd)/conf CONFIG_NAME=config .venv/bin/python models/logistic_regression/preprocessing.py
      model=logistic_regression
    deps:
    - path: data/processed/data_featured.csv
      hash: md5
      md5: 0c59f6ccd93cd6b47eabd842378f78a8
      size: 72854176
    - path: models/logistic_regression/preprocessing.py
      hash: md5
      md5: 8c38aa55c49434d3667217b012393380
      size: 4791
    params:
      params.yaml:
        data.featured_file: data/processed/data_featured.csv
        model.logistic_regression:
          model_file: model.pkl
          params:
            penalty: l2
            C: 1.0
            solver: lbfgs
            max_iter: 1000
            random_state: 42
  model_preprocessing@autogluon:
    cmd: CONFIG_PATH=$(pwd)/conf CONFIG_NAME=config .venv/bin/python models/autogluon/preprocessing.py
      model=autogluon
    deps:
    - path: data/processed/data_featured.csv
      hash: md5
      md5: 0c59f6ccd93cd6b47eabd842378f78a8
      size: 72854176
    - path: models/autogluon/preprocessing.py
      hash: md5
      md5: a16c7c4a89a7f8c88063467180c14f28
      size: 7155
    params:
      params.yaml:
        data.featured_file: data/processed/data_featured.csv
        model.autogluon:
          model_file: model.pkl
          params:
            presets: best_quality
            time_limit: 3600
            verbosity: 2
            gbm_num_boost_round: 100
  model_training@logistic_regression:
    cmd: CONFIG_PATH=$(pwd)/conf CONFIG_NAME=config .venv/bin/python models/logistic_regression/train.py
      model=logistic_regression
    deps:
    - path: models/logistic_regression/artifacts/preprocessed_data.csv
      hash: md5
      md5: 83cc48c279024b3327dc1ccebefeb4ba
      size: 47491440
    - path: models/logistic_regression/train.py
      hash: md5
      md5: 0ddc2ff4e09457f98717b9661d7cb817
      size: 6393
    params:
      params.yaml:
        data.processed: data/processed
        model.logistic_regression:
          model_file: model.pkl
          params:
            penalty: l2
            C: 1.0
            solver: lbfgs
            max_iter: 1000
            random_state: 42
  model_training@autogluon:
    cmd: CONFIG_PATH=$(pwd)/conf CONFIG_NAME=config .venv/bin/python models/autogluon/train.py
      model=autogluon
    deps:
    - path: models/autogluon/artifacts/preprocessed_data.csv
      hash: md5
      md5: ac24323e785816591d8540a9701ca25c
      size: 47491440
    - path: models/autogluon/train.py
      hash: md5
      md5: 5c18f8955f493aecbf143139b337f3c2
      size: 6975
    params:
      params.yaml:
        data.processed: data/processed
        model.autogluon:
          model_file: model.pkl
          params:
            presets: best_quality
            time_limit: 3600
            verbosity: 2
            gbm_num_boost_round: 100
  model_evaluation@logistic_regression:
    cmd: CONFIG_PATH=$(pwd)/conf CONFIG_NAME=config .venv/bin/python models/logistic_regression/evaluate.py
      model=logistic_regression
    deps:
    - path: data/processed/test.csv
      hash: md5
      md5: cfd9fd8441b890900bee61eaaf60a7d8
      size: 14026237
    - path: models/logistic_regression/evaluate.py
      hash: md5
      md5: 9c89212fb567fc2d8442bcc5937aa724
      size: 8235
    params:
      params.yaml:
        model.logistic_regression:
          model_file: model.pkl
          params:
            penalty: l2
            C: 1.0
            solver: lbfgs
            max_iter: 1000
            random_state: 42
    outs:
    - path: models/logistic_regression/artifacts/confusion_matrix.png
      hash: md5
      md5: 221a3e970af5363bebdef825989304fc
      size: 20465
    - path: models/logistic_regression/artifacts/feature_importances.png
      hash: md5
      md5: 79fb1ae5f3ca07a1e2b0937af1e204b3
      size: 239037
    - path: models/logistic_regression/artifacts/metrics.json
      hash: md5
      md5: 975247a502cf20844c375894b26c5325
      size: 181
    - path: models/logistic_regression/artifacts/roc_curve.png
      hash: md5
      md5: 4c2a377ca5971ec4c6504a39ad3f8f21
      size: 35664
  model_evaluation@autogluon:
    cmd: CONFIG_PATH=$(pwd)/conf CONFIG_NAME=config .venv/bin/python models/autogluon/evaluate.py
      model=autogluon
    deps:
    - path: data/processed/test.csv
      hash: md5
      md5: cfd9fd8441b890900bee61eaaf60a7d8
      size: 14026237
    - path: models/autogluon/artifacts/model.pkl
      hash: md5
      md5: 91d32f6c40183eb8adbf8576137c8002
      size: 84095
    - path: models/autogluon/evaluate.py
      hash: md5
      md5: 5885ab8f781e33a35dcb9fd9334d3de3
      size: 8682
    params:
      params.yaml:
        model.autogluon:
          model_file: model.pkl
          params:
            presets: best_quality
            time_limit: 3600
            verbosity: 2
            gbm_num_boost_round: 100
    outs:
    - path: models/autogluon/artifacts/confusion_matrix.png
      hash: md5
      md5: 97e47fac99ddb0a9a49c03207196bca1
      size: 22413
    - path: models/autogluon/artifacts/feature_importances.png
      hash: md5
      md5: a40d928a59f7ee7ad8717163f6d725d5
      size: 117080
    - path: models/autogluon/artifacts/metrics.json
      hash: md5
      md5: a85c5372b8028cfcdec10840527b048d
      size: 181
    - path: models/autogluon/artifacts/roc_curve.png
      hash: md5
      md5: 2196a33b499cd5180ea6f8123425f1c3
      size: 35672
  model_preprocessing@neural_network:
    cmd: CONFIG_PATH=$(pwd)/conf CONFIG_NAME=config .venv/bin/python models/neural_network/preprocessing.py
      model=neural_network
    deps:
    - path: data/processed/data_featured.csv
      hash: md5
      md5: 0c59f6ccd93cd6b47eabd842378f78a8
      size: 72854176
    - path: models/neural_network/preprocessing.py
      hash: md5
      md5: 054edbdf28e077af3c5d557062126f2c
      size: 8162
    params:
      params.yaml:
        data.featured_file: data/processed/data_featured.csv
        model.neural_network:
          model_file: model.pkl
          params:
            layers:
            - units: 64
              activation: relu
              dropout: 0.5
            - units: 32
              activation: relu
              dropout: 0.5
            - units: 32
              activation: relu
              dropout: 0.5
            - units: 16
              activation: relu
            optimizer:
              type: adamw
              learning_rate: 0.0001
            loss: binary_crossentropy
            metrics:
            - accuracy
            batch_size: 32
            epochs: 100
            patience: 15
  model_training@neural_network:
    cmd: CONFIG_PATH=$(pwd)/conf CONFIG_NAME=config .venv/bin/python models/neural_network/train.py
      model=neural_network
    deps:
    - path: models/neural_network/artifacts/preprocessed_data.csv
      hash: md5
      md5: 6bd1a77493dc036fa76e5ad9943bf757
      size: 47531128
    - path: models/neural_network/train.py
      hash: md5
      md5: 381a3f16d1628a2b9794e878e17ef2ce
      size: 4646
    params:
      params.yaml:
        data.processed: data/processed
        model.neural_network:
          model_file: model.pkl
          params:
            layers:
            - units: 64
              activation: relu
              dropout: 0.5
            - units: 32
              activation: relu
              dropout: 0.5
            - units: 32
              activation: relu
              dropout: 0.5
            - units: 16
              activation: relu
            optimizer:
              type: adamw
              learning_rate: 0.0001
            loss: binary_crossentropy
            metrics:
            - accuracy
            batch_size: 32
            epochs: 100
            patience: 15
  model_evaluation@neural_network:
    cmd: CONFIG_PATH=$(pwd)/conf CONFIG_NAME=config .venv/bin/python models/neural_network/evaluate.py
      model=neural_network
    deps:
    - path: data/processed/test.csv
      hash: md5
      md5: cfd9fd8441b890900bee61eaaf60a7d8
      size: 14026237
    - path: models/neural_network/evaluate.py
      hash: md5
      md5: cd7731374c8222871df7218b9cdaa89f
      size: 9997
    params:
      params.yaml:
        model.neural_network:
          model_file: model.pkl
          params:
            layers:
            - units: 64
              activation: relu
              dropout: 0.5
            - units: 32
              activation: relu
              dropout: 0.5
            - units: 32
              activation: relu
              dropout: 0.5
            - units: 16
              activation: relu
            optimizer:
              type: adamw
              learning_rate: 0.0001
            loss: binary_crossentropy
            metrics:
            - accuracy
            batch_size: 32
            epochs: 100
            patience: 15
    outs:
    - path: models/neural_network/artifacts/confusion_matrix.png
      hash: md5
      md5: e5e1ce0f307456a18a5f0511703f4cb6
      size: 20162
    - path: models/neural_network/artifacts/feature_importances.png
      hash: md5
      md5: a18d8dc08f73e3a17adfcd438af5caca
      size: 112277
    - path: models/neural_network/artifacts/metrics.json
      hash: md5
      md5: 117338e005ca87bb2344b07d31f49eac
      size: 180
    - path: models/neural_network/artifacts/roc_curve.png
      hash: md5
      md5: e9ebaad224ea1f60cfb18fb6d55be8ab
      size: 35705
  push_raw_data_to_s3:
    cmd:
    - aws s3 cp data/raw/data.csv s3://your_bucket_name/data/raw/data.csv
    deps:
    - path: data/raw/data.csv
      hash: md5
      md5: dbfe12c203805ccf7fdb683042c46ab3
      size: 49159045
  infrastruct:
    cmd: .venv/bin/python src/infrastruct.py
    deps:
    - path: requirements-frozen.txt
      hash: md5
      md5: 495bf7a4ad0fc161c91a663531b153ca
      size: 8410
    - path: src/infrastruct.py
      hash: md5
      md5: 007ddab3349fca1540e75fc7add9923b
      size: 17745
      isexec: true
  preprocess:
    cmd: .venv/bin/python src/preprocess.py
    deps:
    - path: data/raw/data.csv
      hash: md5
      md5: 33411fa1536aaaadb24c0c1f2a8598b9
      size: 16246860
    - path: requirements-frozen.txt
      hash: md5
      md5: 495bf7a4ad0fc161c91a663531b153ca
      size: 8410
    - path: src/preprocess.py
      hash: md5
      md5: 0b7744d4f077b48b6305fb99a25bd9c8
      size: 11197
    outs:
    - path: data/interim/data_cleaned.parquet
      hash: md5
      md5: 134acddfa1711ae8b4da5ae4a2563557
      size: 1699934
  featurize:
    cmd: PROTOCOL_BUFFERS_PYTHON_IMPLEMENTATION=python .venv/bin/python src/featurize.py
    deps:
    - path: data/interim/data_cleaned.parquet
      hash: md5
      md5: 134acddfa1711ae8b4da5ae4a2563557
      size: 1699934
    - path: feature_store.yaml
      hash: md5
      md5: fd33cd8885f2ace4a3063c10ad6b5ba5
      size: 166
    - path: requirements-frozen.txt
      hash: md5
      md5: 495bf7a4ad0fc161c91a663531b153ca
      size: 8410
    - path: src/featurize.py
      hash: md5
      md5: a062a48a81781f5acc1d7389bb52b0fe
      size: 17895
    outs:
    - path: data/interim/data_featured.parquet
      hash: md5
      md5: 2ed4d4b80edccfe6a1d6d088610b6e5f
      size: 26827726
  explore:
    cmd: .venv/bin/python src/explore.py
    deps:
    - path: data/interim/data_cleaned.parquet
      hash: md5
      md5: 134acddfa1711ae8b4da5ae4a2563557
      size: 1699934
    - path: data/raw/data.parquet
      hash: md5
      md5: 70194fd7340a638e7a98b5d5a2a99ed6
      size: 1419892
    - path: requirements-frozen.txt
      hash: md5
      md5: 495bf7a4ad0fc161c91a663531b153ca
      size: 8410
    - path: src/explore.py
      hash: md5
      md5: a82f7a15e6df316bf21ce22fd5aafb54
      size: 12410
    outs:
    - path: reports/cleanlab/cleanlab_confidence_distribution.png
      hash: md5
      md5: 706bf37c1bdd1f2a894fa9c9e2d071b9
      size: 159782
    - path: reports/cleanlab/cleanlab_confusion_matrix.png
      hash: md5
      md5: 02fb99ed2f166c6690d23f223ea3e83e
      size: 99624
    - path: reports/cleanlab/detailed_analysis.txt
      hash: md5
      md5: 463c91840fe41b211352ee2dfeac7d89
      size: 675
    - path: reports/cleanlab/feature_importance.csv
      hash: md5
      md5: 8fc113b9389194e3d5adb3fa3d1dde55
      size: 52807
    - path: reports/cleanlab/problematic_cases.csv
      hash: md5
      md5: 23f89ee798c93af697a8af45905342a7
      size: 220479
    - path: reports/plots/age_vs_readmission.png
      hash: md5
      md5: 8a40bd9fb68422f1fe4fe48da768cd01
      size: 184203
    - path: reports/plots/correlation_matrix.png
      hash: md5
      md5: b8d3693618e7ab03f4ca80e19009a35e
      size: 676101
    - path: reports/plots/readmitted_distribution.png
      hash: md5
      md5: 6b8c2cd4f4c2c346e54bccc300fbca54
      size: 93876
    - path: reports/plots/service_utilization_vs_readmission.png
      hash: md5
      md5: bd6ef7a2dbeb2b59ee003de7ae96c8ac
      size: 101081
    - path: reports/plots/time_in_hospital_vs_readmission.png
      hash: md5
      md5: 27667f6e3a4c238b25c3805b2753aa21
      size: 93844

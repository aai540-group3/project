schema: '2.0'
stages:
  setup:
    cmd:
    - python3 -m virtualenv .venv
    - . .venv/bin/activate
    - pip install uv
    - uv pip install -r requirements.txt
    - pip freeze > requirements-frozen.txt
    deps:
    - path: requirements.txt
      hash: md5
      md5: eac02b8a58ddb33da68533bcfa0737cd
      size: 321
    outs:
    - path: requirements-frozen.txt
      hash: md5
      md5: 495bf7a4ad0fc161c91a663531b153ca
      size: 8410
  infrastruct:
    cmd: .venv/bin/python src/infrastruct.py
    deps:
    - path: requirements-frozen.txt
      hash: md5
      md5: 495bf7a4ad0fc161c91a663531b153ca
      size: 8410
    - path: src/infrastruct.py
      hash: md5
      md5: 007ddab3349fca1540e75fc7add9923b
      size: 17745
      isexec: true
  preprocess:
    cmd: .venv/bin/python src/preprocess.py
    deps:
    - path: data/raw/data.csv
      hash: md5
      md5: 33411fa1536aaaadb24c0c1f2a8598b9
      size: 16246860
    - path: requirements-frozen.txt
      hash: md5
      md5: 495bf7a4ad0fc161c91a663531b153ca
      size: 8410
    - path: src/preprocess.py
      hash: md5
      md5: 948838f570aa710cc894402282f37a75
      size: 11614
    outs:
    - path: data/interim/data_cleaned.parquet
      hash: md5
      md5: 52418c151fcc4029bed2b6fc5050b5e9
      size: 1699934
    - path: data/interim/feature_names.joblib
      hash: md5
      md5: 7223e8718fe6f7173ebc871bf4d5cc6d
      size: 637
  featurize:
    cmd: PROTOCOL_BUFFERS_PYTHON_IMPLEMENTATION=python .venv/bin/python src/featurize.py
    deps:
    - path: data/interim/data_cleaned.parquet
      hash: md5
      md5: 52418c151fcc4029bed2b6fc5050b5e9
      size: 1699934
    - path: feature_store.yaml
      hash: md5
      md5: fd33cd8885f2ace4a3063c10ad6b5ba5
      size: 166
    - path: requirements-frozen.txt
      hash: md5
      md5: 495bf7a4ad0fc161c91a663531b153ca
      size: 8410
    - path: src/featurize.py
      hash: md5
      md5: ec07d69a01cbf5f2b35840f40139f58b
      size: 15265
    outs:
    - path: data/interim/data_featured.parquet
      hash: md5
      md5: bcfcb4257ebc5523176cabc88c2278c3
      size: 4971381
  explore:
    cmd: .venv/bin/python src/explore.py
    deps:
    - path: data/interim/data_cleaned.parquet
      hash: md5
      md5: 52418c151fcc4029bed2b6fc5050b5e9
      size: 1699934
    - path: data/raw/data.csv
      hash: md5
      md5: 33411fa1536aaaadb24c0c1f2a8598b9
      size: 16246860
    - path: requirements-frozen.txt
      hash: md5
      md5: 495bf7a4ad0fc161c91a663531b153ca
      size: 8410
    - path: src/explore.py
      hash: md5
      md5: 5db5255030273c94d257a5799ff2e917
      size: 12372
    outs:
    - path: reports/cleanlab/cleanlab_confidence_distribution.png
      hash: md5
      md5: 0616affc7242f85f5451826c55df82ce
      size: 161293
    - path: reports/cleanlab/cleanlab_confusion_matrix.png
      hash: md5
      md5: 8a885443373dbb45858052b261da65ea
      size: 102421
    - path: reports/cleanlab/detailed_analysis.txt
      hash: md5
      md5: 307ce3343fc0827a3c4ff18a6e2cdb7e
      size: 675
    - path: reports/cleanlab/feature_importance.csv
      hash: md5
      md5: ffa5511b494e72bde4c6fb7adf26f36c
      size: 52412
    - path: reports/cleanlab/problematic_cases.csv
      hash: md5
      md5: 251ce7c020c5fbf3876532f98a9e5ad3
      size: 218660
    - path: reports/plots/age_vs_readmission.png
      hash: md5
      md5: 480cd634ff6177de5d3c70da9540db60
      size: 185455
    - path: reports/plots/correlation_matrix.png
      hash: md5
      md5: 4422abf47b3b73a3c3e206ce6561572d
      size: 1012505
    - path: reports/plots/readmitted_distribution.png
      hash: md5
      md5: 4548dca5267dfe53e0505cda33a9da66
      size: 93849
    - path: reports/plots/service_utilization_vs_readmission.png
      hash: md5
      md5: b7f6b4c74aae03e15d5bc9d7772e641a
      size: 100897
    - path: reports/plots/time_in_hospital_vs_readmission.png
      hash: md5
      md5: 41452169c3dfb9b9acfc5e438b9a1fee
      size: 93487
  ingest_parquet:
    cmd: .venv/bin/python src/ingest.py
    deps:
    - path: requirements-frozen.txt
      hash: md5
      md5: 495bf7a4ad0fc161c91a663531b153ca
      size: 8410
    - path: src/ingest.py
      hash: md5
      md5: 4834dee50d39bc8738573b1d25632ce3
      size: 2691
    outs:
    - path: data/raw/data.parquet
      hash: md5
      md5: 70194fd7340a638e7a98b5d5a2a99ed6
      size: 1419892
  ingest_csv:
    cmd: .venv/bin/python src/ingest.py
    deps:
    - path: requirements-frozen.txt
      hash: md5
      md5: 495bf7a4ad0fc161c91a663531b153ca
      size: 8410
    - path: src/ingest.py
      hash: md5
      md5: 4834dee50d39bc8738573b1d25632ce3
      size: 2691
    outs:
    - path: data/raw/data.csv
      hash: md5
      md5: 33411fa1536aaaadb24c0c1f2a8598b9
      size: 16246860
    - path: data/raw/metadata.json
      hash: md5
      md5: eb8bd36c2cc7a6284a657c63561e0225
      size: 5125
    - path: data/raw/variables.json
      hash: md5
      md5: c03764d3560b025c3f1291d585517221
      size: 19001
  ingest:
    cmd: .venv/bin/python src/ingest.py
    deps:
    - path: requirements-frozen.txt
      hash: md5
      md5: 495bf7a4ad0fc161c91a663531b153ca
      size: 8410
    - path: src/ingest.py
      hash: md5
      md5: 4834dee50d39bc8738573b1d25632ce3
      size: 2691
    outs:
    - path: data/raw/data.csv
      hash: md5
      md5: 33411fa1536aaaadb24c0c1f2a8598b9
      size: 16246860
    - path: data/raw/data.parquet
      hash: md5
      md5: 715fc5c0f345a1e7efc9136c4c5da15a
      size: 1419892
    - path: data/raw/metadata.json
      hash: md5
      md5: eb8bd36c2cc7a6284a657c63561e0225
      size: 5125
    - path: data/raw/variables.json
      hash: md5
      md5: c03764d3560b025c3f1291d585517221
      size: 19001
  train_logistic_regression:
    cmd: .venv/bin/python models/logistic_regression/model.py
    deps:
    - path: data/interim/data_featured.parquet
      hash: md5
      md5: bcfcb4257ebc5523176cabc88c2278c3
      size: 4971381
    - path: models/logistic_regression/model.py
      hash: md5
      md5: df7d5793fa43b6d64227fb82088ddd52
      size: 18556
    - path: requirements-frozen.txt
      hash: md5
      md5: 495bf7a4ad0fc161c91a663531b153ca
      size: 8410
  train_autogluon:
    cmd: PROTOCOL_BUFFERS_PYTHON_IMPLEMENTATION=python .venv/bin/python models/autogluon/model.py
    deps:
    - path: data/interim/data_featured.parquet
      hash: md5
      md5: bcfcb4257ebc5523176cabc88c2278c3
      size: 4971381
    - path: models/autogluon/model.py
      hash: md5
      md5: 24b83fd37beaf1a56bb794a50036dcde
      size: 18491
    - path: requirements-frozen.txt
      hash: md5
      md5: 495bf7a4ad0fc161c91a663531b153ca
      size: 8410

schema: '2.0'
stages:
  setup:
    cmd:
    - pip install uv virtualenv
    - dvc dag --md >> dag.md
    - rm -rf .markers
    - mkdir .markers
    - echo "done" > .markers/setup.done
    outs:
    - path: .markers/setup.done
      hash: md5
      md5: 678e5e019a79526d0fcca5e29f6e5f78
      size: 5
  infrastruct:
    cmd:
    - uv venv .venv-infrastruct --python 3.10
    - . .venv-infrastruct/bin/activate && uv pip install -r requirements-infrastruct.txt
    - . .venv-infrastruct/bin/activate && uv pip freeze > requirements-infrastruct-frozen.txt
    - . .venv-infrastruct/bin/activate && python src/infrastruct.py
    - echo "done" > .markers/infrastruct.done
    deps:
    - path: .markers/setup.done
      hash: md5
      md5: 678e5e019a79526d0fcca5e29f6e5f78
      size: 5
    - path: requirements-infrastruct.txt
      hash: md5
      md5: 60b865dddcfe1ba5e216406717be77a4
      size: 19
    - path: src/infrastruct.py
      hash: md5
      md5: 007ddab3349fca1540e75fc7add9923b
      size: 17745
      isexec: true
    outs:
    - path: .markers/infrastruct.done
      hash: md5
      md5: 678e5e019a79526d0fcca5e29f6e5f78
      size: 5
    - path: .venv-infrastruct
      hash: md5
      md5: ef140a34660064bd776dc27b42f2826d.dir
      size: 18727288
      nfiles: 1985
    - path: requirements-infrastruct-frozen.txt
      hash: md5
      md5: 7a6a7eeb309a45fd9b797ba5f283ef4e
      size: 145
  preprocess:
    cmd:
    - uv venv .venv-preprocess --python 3.10
    - . .venv-preprocess/bin/activate && uv pip install -r requirements-preprocess.txt
    - . .venv-preprocess/bin/activate && uv pip freeze > requirements-preprocess-frozen.txt
    - . .venv-preprocess/bin/activate && python src/preprocess.py
    - echo "done" > .markers/preprocess.done
    deps:
    - path: .markers/ingest.done
      hash: md5
      md5: 678e5e019a79526d0fcca5e29f6e5f78
      size: 5
    - path: data/raw/data.csv
      hash: md5
      md5: 33411fa1536aaaadb24c0c1f2a8598b9
      size: 16246860
    - path: requirements-preprocess.txt
      hash: md5
      md5: 2e6b6474c7d7de529a7e5dc2b1761a27
      size: 50
    - path: src/preprocess.py
      hash: md5
      md5: 84834c66b8782f7e27bd3b3d1a949342
      size: 11574
    outs:
    - path: .markers/preprocess.done
      hash: md5
      md5: 678e5e019a79526d0fcca5e29f6e5f78
      size: 5
    - path: .venv-preprocess
      hash: md5
      md5: 9d8b7ff24ce1fd16f1f271af471c3e51.dir
      size: 374723645
      nfiles: 16192
    - path: data/interim/data_cleaned.parquet
      hash: md5
      md5: cf03903ad3c1c4e1237e61e069738635
      size: 1789303
    - path: data/interim/feature_names.joblib
      hash: md5
      md5: 7223e8718fe6f7173ebc871bf4d5cc6d
      size: 637
    - path: requirements-preprocess-frozen.txt
      hash: md5
      md5: c1c9e5fcaba196be4c96911ddc597dda
      size: 3182
  featurize:
    cmd:
    - uv venv .venv-featurize --python 3.11
    - . .venv-featurize/bin/activate && uv pip install -r requirements-featurize.txt
    - . .venv-featurize/bin/activate && uv pip freeze > requirements-featurize-frozen.txt
    - . .venv-featurize/bin/activate && python src/featurize.py
    - echo "done" > .markers/featurize.done
    deps:
    - path: .markers/explore.done
      hash: md5
      md5: 678e5e019a79526d0fcca5e29f6e5f78
      size: 5
    - path: data/interim/data_cleaned.parquet
      hash: md5
      md5: cf03903ad3c1c4e1237e61e069738635
      size: 1789303
    - path: feature_store.yaml
      hash: md5
      md5: f690725d429449b466c260205d8da47a
      size: 202
    - path: requirements-featurize.txt
      hash: md5
      md5: 4f9f52b9fe2d29796d3f210c33ed92d0
      size: 102
    - path: src/featurize.py
      hash: md5
      md5: a561076dd413ab2a74293d096c15b078
      size: 15383
    outs:
    - path: .markers/featurize.done
      hash: md5
      md5: 678e5e019a79526d0fcca5e29f6e5f78
      size: 5
    - path: .venv-featurize
      hash: md5
      md5: 90b3f17f833f2d1707bb7e8d3e428d5a.dir
      size: 421494223
      nfiles: 18508
    - path: data/interim/data_featured.parquet
      hash: md5
      md5: f508abc6a720c94f159db3c2139edc8d
      size: 5210972
    - path: requirements-featurize-frozen.txt
      hash: md5
      md5: d7ef7573f0a519e25352f65bd353cd8b
      size: 3792
  explore:
    cmd:
    - uv venv .venv-explore --python 3.10
    - . .venv-explore/bin/activate && uv pip install -r requirements-explore.txt
    - . .venv-explore/bin/activate && uv pip freeze > requirements-explore-frozen.txt
    - . .venv-explore/bin/activate && python src/explore.py
    - echo "done" > .markers/explore.done
    deps:
    - path: .markers/preprocess.done
      hash: md5
      md5: 678e5e019a79526d0fcca5e29f6e5f78
      size: 5
    - path: data/interim/data_cleaned.parquet
      hash: md5
      md5: cf03903ad3c1c4e1237e61e069738635
      size: 1789303
    - path: data/raw/data.csv
      hash: md5
      md5: 33411fa1536aaaadb24c0c1f2a8598b9
      size: 16246860
    - path: requirements-explore.txt
      hash: md5
      md5: 85a632c1e6e277324146aeefa4c606e2
      size: 87
    - path: src/explore.py
      hash: md5
      md5: 1c641b4a5bbfcf6bb2f28c0c766542c8
      size: 12365
    outs:
    - path: .markers/explore.done
      hash: md5
      md5: 678e5e019a79526d0fcca5e29f6e5f78
      size: 5
    - path: .venv-explore
      hash: md5
      md5: e343220ed6080a7fe0ee09a87d2088d3.dir
      size: 410743707
      nfiles: 17395
    - path: reports/cleanlab/cleanlab_confidence_distribution.png
      hash: md5
      md5: 4af27aaab54bfbb412cf9bf28cacc53f
      size: 158436
    - path: reports/cleanlab/cleanlab_confusion_matrix.png
      hash: md5
      md5: 51e1c38f809af3f9d37b846c1dba4f04
      size: 103366
    - path: reports/cleanlab/detailed_analysis.txt
      hash: md5
      md5: b8d4efc9b1b128683232e05fc85fcf6e
      size: 675
    - path: reports/cleanlab/feature_importance.csv
      hash: md5
      md5: 43b6a849a1ff727ec9f0cb70ba970971
      size: 52171
    - path: reports/cleanlab/problematic_cases.csv
      hash: md5
      md5: de3c2f23e32f5ca5debc8628cd685492
      size: 222212
    - path: reports/plots/age_vs_readmission.png
      hash: md5
      md5: 480cd634ff6177de5d3c70da9540db60
      size: 185455
    - path: reports/plots/correlation_matrix.png
      hash: md5
      md5: 87fe50fd721218ce83de874aa4e2c6cf
      size: 1665656
    - path: reports/plots/readmitted_distribution.png
      hash: md5
      md5: 4548dca5267dfe53e0505cda33a9da66
      size: 93849
    - path: reports/plots/service_utilization_vs_readmission.png
      hash: md5
      md5: b7f6b4c74aae03e15d5bc9d7772e641a
      size: 100897
    - path: reports/plots/time_in_hospital_vs_readmission.png
      hash: md5
      md5: 41452169c3dfb9b9acfc5e438b9a1fee
      size: 93487
    - path: requirements-explore-frozen.txt
      hash: md5
      md5: c592ec5f8ef563b4e72893d627a445fc
      size: 3333
  ingest_parquet:
    cmd: .venv/bin/python src/ingest.py
    deps:
    - path: requirements-frozen.txt
      hash: md5
      md5: 495bf7a4ad0fc161c91a663531b153ca
      size: 8410
    - path: src/ingest.py
      hash: md5
      md5: 4834dee50d39bc8738573b1d25632ce3
      size: 2691
    outs:
    - path: data/raw/data.parquet
      hash: md5
      md5: 70194fd7340a638e7a98b5d5a2a99ed6
      size: 1419892
  ingest_csv:
    cmd: .venv/bin/python src/ingest.py
    deps:
    - path: requirements-frozen.txt
      hash: md5
      md5: 495bf7a4ad0fc161c91a663531b153ca
      size: 8410
    - path: src/ingest.py
      hash: md5
      md5: 4834dee50d39bc8738573b1d25632ce3
      size: 2691
    outs:
    - path: data/raw/data.csv
      hash: md5
      md5: 33411fa1536aaaadb24c0c1f2a8598b9
      size: 16246860
    - path: data/raw/metadata.json
      hash: md5
      md5: eb8bd36c2cc7a6284a657c63561e0225
      size: 5125
    - path: data/raw/variables.json
      hash: md5
      md5: c03764d3560b025c3f1291d585517221
      size: 19001
  ingest:
    cmd:
    - uv venv .venv-ingest --python 3.10
    - . .venv-ingest/bin/activate && uv pip install -r requirements-ingest.txt
    - . .venv-ingest/bin/activate && uv pip freeze > requirements-ingest-frozen.txt
    - . .venv-ingest/bin/activate && python src/ingest.py
    - echo "done" > .markers/ingest.done
    deps:
    - path: .markers/infrastruct.done
      hash: md5
      md5: 678e5e019a79526d0fcca5e29f6e5f78
      size: 5
    - path: requirements-ingest.txt
      hash: md5
      md5: b6ace7c12bf4b84c615e2b4e80cd6b96
      size: 81
    - path: src/ingest.py
      hash: md5
      md5: 4834dee50d39bc8738573b1d25632ce3
      size: 2691
    outs:
    - path: .markers/ingest.done
      hash: md5
      md5: 678e5e019a79526d0fcca5e29f6e5f78
      size: 5
    - path: .venv-ingest
      hash: md5
      md5: d8ccf5a525b42ac0882a372eae231c49.dir
      size: 374796304
      nfiles: 16220
    - path: data/raw/data.csv
      hash: md5
      md5: 33411fa1536aaaadb24c0c1f2a8598b9
      size: 16246860
    - path: data/raw/data.parquet
      hash: md5
      md5: 80180ca21b2e0a18573675cdb3f741de
      size: 1415409
    - path: data/raw/metadata.json
      hash: md5
      md5: eb8bd36c2cc7a6284a657c63561e0225
      size: 5125
    - path: data/raw/variables.json
      hash: md5
      md5: c03764d3560b025c3f1291d585517221
      size: 19001
    - path: requirements-ingest-frozen.txt
      hash: md5
      md5: bbf7e249541619d0455edee9bfac1e04
      size: 3220
  train_logistic_regression:
    cmd: .venv/bin/python models/logistic_regression/model.py
    deps:
    - path: data/interim/data_featured.parquet
      hash: md5
      md5: bcfcb4257ebc5523176cabc88c2278c3
      size: 4971381
    - path: models/logistic_regression/model.py
      hash: md5
      md5: df7d5793fa43b6d64227fb82088ddd52
      size: 18556
    - path: requirements-frozen.txt
      hash: md5
      md5: 495bf7a4ad0fc161c91a663531b153ca
      size: 8410
  train_autogluon:
    cmd:
    - uv venv .venv-autogluon --python 3.10
    - . .venv-autogluon/bin/activate && uv pip install -r requirements-autogluon.txt
    - . .venv-autogluon/bin/activate && uv pip freeze > requirements-autogluon-frozen.txt
    - . .venv-autogluon/bin/activate && python src/utils.py patch_nvidia_gpu
    - . .venv-autogluon/bin/activate && PROTOCOL_BUFFERS_PYTHON_IMPLEMENTATION=python
      python models/autogluon/model.py
    - echo "done" > .markers/train_autogluon.done
    deps:
    - path: .markers/train_neuralnetwork.done
      hash: md5
      md5: 678e5e019a79526d0fcca5e29f6e5f78
      size: 5
    - path: data/interim/data_featured.parquet
      hash: md5
      md5: 6ecf081afc8ca3513f1f6b3f8606c0c5
      size: 5210972
    - path: models/autogluon/model.py
      hash: md5
      md5: 75246488f36b798e18b7e26a4d02fc57
      size: 16473
    - path: requirements-autogluon.txt
      hash: md5
      md5: 2a3814eba1bc90e700e781a357c06ede
      size: 106
    outs:
    - path: .markers/train_autogluon.done
      hash: md5
      md5: 678e5e019a79526d0fcca5e29f6e5f78
      size: 5
    - path: .venv-autogluon
      hash: md5
      md5: d921204f63aee2d613eda75df8eaf0ca.dir
      size: 3861437351
      nfiles: 68274
    - path: models/autogluon/artifacts/metrics/metrics.json
      hash: md5
      md5: 6cedbbb5a3bd24b170f72ce5d12d8b21
      size: 191
    - path: models/autogluon/artifacts/model
      hash: md5
      md5: 6eb1bdf23dbc904bd77708978ee9b882.dir
      size: 51173
      nfiles: 10
    - path: models/autogluon/artifacts/plots/confusion_matrix.png
      hash: md5
      md5: 42c10c96deee8111d7bc4085a7a688e0
      size: 109307
    - path: models/autogluon/artifacts/plots/feature_importance.png
      hash: md5
      md5: 473d4d6b2c41b1c2748b0da4584f8460
      size: 243218
    - path: models/autogluon/artifacts/plots/roc_curve.png
      hash: md5
      md5: 99fe191ccfdccddaf4eb5c0f0a56c965
      size: 176597
    - path: requirements-autogluon-frozen.txt
      hash: md5
      md5: f91c9a1e47bdc6c772b776a08c4ba889
      size: 6053
  train_neural_network:
    cmd: .venv/bin/python models/neural_network/model.py
    deps:
    - path: data/interim/data_featured.parquet
      hash: md5
      md5: bcfcb4257ebc5523176cabc88c2278c3
      size: 4971381
    - path: models/neural_network/model.py
      hash: md5
      md5: e0dab3b3599ff9845ddc32e38cfed965
      size: 20372
    - path: requirements-frozen.txt
      hash: md5
      md5: 495bf7a4ad0fc161c91a663531b153ca
      size: 8410
  train_logisticregression:
    cmd:
    - uv venv .venv-logisticregression --python 3.10
    - . .venv-logisticregression/bin/activate && uv pip install -r requirements-logisticregression.txt
    - . .venv-logisticregression/bin/activate && uv pip freeze > requirements-logisticregression-frozen.txt
    - . .venv-logisticregression/bin/activate && python models/logistic_regression/model.py
    - echo "done" > .markers/train_logisticregression.done
    deps:
    - path: .markers/featurize.done
      hash: md5
      md5: 678e5e019a79526d0fcca5e29f6e5f78
      size: 5
    - path: data/interim/data_featured.parquet
      hash: md5
      md5: 6ecf081afc8ca3513f1f6b3f8606c0c5
      size: 5210972
    - path: models/logistic_regression/model.py
      hash: md5
      md5: e58b505ea8ed56b3beb02fcdf46e698b
      size: 17917
    - path: requirements-logisticregression.txt
      hash: md5
      md5: 51f39049342d2ccec98f0f9868bbc68b
      size: 84
    outs:
    - path: .markers/train_logisticregression.done
      hash: md5
      md5: 678e5e019a79526d0fcca5e29f6e5f78
      size: 5
    - path: .venv-logisticregression
      hash: md5
      md5: 227d5ab4be46fbf2e442a769519967be.dir
      size: 421947640
      nfiles: 18184
    - path: models/logistic_regression/artifacts/metrics/metrics.json
      hash: md5
      md5: f3624ca6827354fb4780c2c9a68943c7
      size: 480
    - path: models/logistic_regression/artifacts/model
      hash: md5
      md5: d3b9cfb88049175b27571e4066330317.dir
      size: 7508
      nfiles: 4
    - path: models/logistic_regression/artifacts/plots/confusion_matrix.png
      hash: md5
      md5: 504baef6eb2985cbb406d6423bdbcbd9
      size: 108136
    - path: models/logistic_regression/artifacts/plots/roc_curve.png
      hash: md5
      md5: b051a4c39f14e5681a1ec01e251aef80
      size: 195054
    - path: requirements-logisticregression-frozen.txt
      hash: md5
      md5: 74ceb32d42ea550034047da3864a9df4
      size: 3449
  train_neuralnetwork:
    cmd:
    - uv venv .venv-neuralnetwork --python 3.10
    - . .venv-neuralnetwork/bin/activate && uv pip install -r requirements-neuralnetwork.txt
    - . .venv-neuralnetwork/bin/activate && uv pip freeze > requirements-neuralnetwork-frozen.txt
    - . .venv-neuralnetwork/bin/activate && PROTOCOL_BUFFERS_PYTHON_IMPLEMENTATION=python
      python models/neural_network/model.py
    - echo "done" > .markers/train_neuralnetwork.done
    deps:
    - path: .markers/train_logisticregression.done
      hash: md5
      md5: 678e5e019a79526d0fcca5e29f6e5f78
      size: 5
    - path: data/interim/data_featured.parquet
      hash: md5
      md5: 6ecf081afc8ca3513f1f6b3f8606c0c5
      size: 5210972
    - path: models/neural_network/model.py
      hash: md5
      md5: 92c40c0c3ded8d6c1b3c5a5b7774117c
      size: 20294
    - path: requirements-neuralnetwork.txt
      hash: md5
      md5: 4df5a9fd8258b79c4c9af987eafd5007
      size: 99
    outs:
    - path: .markers/train_neuralnetwork.done
      hash: md5
      md5: 678e5e019a79526d0fcca5e29f6e5f78
      size: 5
    - path: .venv-neuralnetwork
      hash: md5
      md5: 0266dda7a6777fc216cc5f1c2f512565.dir
      size: 1979320370
      nfiles: 35636
    - path: models/neural_network/artifacts/metrics/metrics.json
      hash: md5
      md5: 72f11cb12909f56495f4219db43d3359
      size: 758
    - path: models/neural_network/artifacts/model
      hash: md5
      md5: eb0c36f1e23ae08c7e5361eba4bbe425.dir
      size: 131997
      nfiles: 4
    - path: models/neural_network/artifacts/plots/confusion_matrix.png
      hash: md5
      md5: ed9a5f2fbcc3c451e9765c1db151aa9c
      size: 111670
    - path: models/neural_network/artifacts/plots/model_architecture.png
      hash: md5
      md5: 03cd8da41577c10e36416a2a9c4c9dec
      size: 220369
    - path: models/neural_network/artifacts/plots/roc_curve.png
      hash: md5
      md5: b6ddf3f04dba0624280205a3d8191825
      size: 197869
    - path: requirements-neuralnetwork-frozen.txt
      hash: md5
      md5: b16d8ab17bb28065eee0b78277a1cc97
      size: 3825
  deploy:
    cmd:
    - uv venv .venv-deploy --python 3.10
    - . .venv-deploy/bin/activate && uv pip install -r requirements-deploy.txt
    - . .venv-deploy/bin/activate && uv pip freeze > requirements-deploy-frozen.txt
    - . .venv-deploy/bin/activate && python src/deploy.py
    - echo "done" > .markers/deploy.done
    deps:
    - path: .markers/train_autogluon.done
      hash: md5
      md5: 678e5e019a79526d0fcca5e29f6e5f78
      size: 5
    - path: .markers/train_logisticregression.done
      hash: md5
      md5: 678e5e019a79526d0fcca5e29f6e5f78
      size: 5
    - path: .markers/train_neuralnetwork.done
      hash: md5
      md5: 678e5e019a79526d0fcca5e29f6e5f78
      size: 5
    - path: models/autogluon/artifacts/metrics/metrics.json
      hash: md5
      md5: 6cedbbb5a3bd24b170f72ce5d12d8b21
      size: 191
    - path: models/autogluon/artifacts/model/feature_importance.csv
      hash: md5
      md5: 1b93b41477957f69e27b758b8bb029a4
      size: 4499
    - path: models/autogluon/artifacts/model/predictor.pkl
      hash: md5
      md5: 4ab5049f6ea274bdfcb4657386a6fd74
      size: 498
    - path: models/logistic_regression/artifacts/metrics/metrics.json
      hash: md5
      md5: f3624ca6827354fb4780c2c9a68943c7
      size: 480
    - path: models/logistic_regression/artifacts/model/model.joblib
      hash: md5
      md5: f33f24d5505d2b3409e5f6d235cdf246
      size: 1631
    - path: models/neural_network/artifacts/metrics/metrics.json
      hash: md5
      md5: 72f11cb12909f56495f4219db43d3359
      size: 758
    - path: models/neural_network/artifacts/model/model.keras
      hash: md5
      md5: 3d50dbbe57b8d76a5504d900c6e29b08
      size: 122759
    - path: src/deploy.py
      hash: md5
      md5: 6c63a3fe9d32237a68c7270cf4113f48
      size: 23333
    outs:
    - path: .markers/deploy.done
      hash: md5
      md5: 678e5e019a79526d0fcca5e29f6e5f78
      size: 5
    - path: huggingface/models/diabetes-readmission
      hash: md5
      md5: 09a16df4db0f80ba38325ed897f91e66.dir
      size: 1632092
      nfiles: 38
    - path: requirements-deploy-frozen.txt
      hash: md5
      md5: 67e6872012e8def4945da48dfe1198f8
      size: 3598

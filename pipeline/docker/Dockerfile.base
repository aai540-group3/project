# =================================================================================
# Base Image for Pipeline Stages
# =================================================================================
FROM python:3.11-slim

# ---------------------------------------------------------------------------------
# Environment Variables
# ---------------------------------------------------------------------------------
ENV PYTHONUNBUFFERED=1 \
    PYTHONDONTWRITEBYTECODE=1 \
    LANG=C.UTF-8

# ---------------------------------------------------------------------------------
# Install Build Dependencies
# ---------------------------------------------------------------------------------
RUN apt-get update && \
    apt-get install \
    --yes \
    --no-install-recommends \
    build-essential \
    git \
    curl \
    && rm -rf /var/lib/apt/lists/*

# ---------------------------------------------------------------------------------
# Upgrade pip
# ---------------------------------------------------------------------------------
RUN pip install --no-cache-dir --upgrade pip

# ---------------------------------------------------------------------------------
# Install Common Dependencies
# ---------------------------------------------------------------------------------
RUN pip install \
    --no-cache-dir \
    dvclive \
    hydra-colorlog \
    hydra-core \
    loguru \
    mlflow \
    python-dotenv \
    wandb

# ---------------------------------------------------------------------------------
# Set Working Directory
# ---------------------------------------------------------------------------------
WORKDIR /app
